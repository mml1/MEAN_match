<html ng-app= "gApp">
<head>
	<title>Flip Cards</title>
	<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
	<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular-route.min.js"></script>
	 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<link rel ="stylesheet" href = "static/stylesheets/style.css">
	<script type="text/javascript">
		var gAppModule = angular.module("gApp", ["ngRoute"]);
		gAppModule.config(function($routeProvider){
			$routeProvider
			.when("/users", {
				templateUrl: "../static/partials/users.html"
			}).otherwise({
				templateUrl: "../static/partials/board.html"
			})		
		});

		gAppModule.factory("BoardFactory", function($http){
			var factory = {};
			var cards =[];
			var faces = ["Apple", "Orange", "Mango","Grape", "Pear", "Guava", "Apple", "Orange", "Mango","Grape", "Pear", "Guava"];

			//shuffle the array
			function shuffle(array){
				var temp;
				var rand;
				for(var i = array.length-1; i > 0; i --){
					rand = Math.floor(Math.random() * i);
					temp = array[i];
					array[i] = array[rand];
					array[rand] = temp;
				}
				return array;
			};
			//actually shuffle the array
			shuffle(faces)

			// create the cards for the board
			for(var i =0; i< 4; i++){
				cards.push([]);
				for(var j =0 ; j<3; j++){
					var index = i*3+j;
					cards[i].push({card:{
						id: index,
						flip: false,
						col:j,
						row: i,
						match: false,
						face: faces[index]
					}});
				};
			};

			factory.getBoard = function(callback){
				callback(cards);
			};
			factory.updateBoard= function(flip, callback){
				cards = flip;
			}
			return factory;
		});
		gAppModule.factory("UserFactory", function($http){
			var factory = {};
			var users = [];
			factory.index = function(callback){
				$http.get("/REPLACE").success(function(dbinfo){
					users = dbinfo;
					callback(users);
				});
			};
			return factory;
		});

		gAppModule.controller("UsersController", function($scope, UserFactory){
			UserFactory.index(function(dbinfo){
				$scope.users = dbinfo;
			});
		});
		gAppModule.controller("MovesController", function($scope, BoardFactory, $timeout){
			var pair = [];
			var wins = 0;
			var start = Math.floor(Date.now()/1000)
			//information about the game to be stored in models
			$scope.numClicks = 0;
			$scope.totClicks = 0;
			$scope.wins = 0;
			$scope.misses = 0;
		
			BoardFactory.getBoard(function(cards){
				$scope.cards = cards;
			})

			$scope.flip = function(){
				BoardFactory.updateBoard($scope.cards, function(newCards){
					BoardFactory.getBoard(function(cards){
						$scope.cards = cards;
					})
				});
			}
			$scope.autoFlip = function(col, row, id){
				console.log(col, row, "passed in information");
				$timeout(function(){
					for(var r =0; r<$scope.cards.length; r++){
						// console.log(id)
						for(var c = 0; c < $scope.cards[r].length; c++){
							if(id == $scope.cards[r][c].card.id){
								$scope.cards[r][c].card.flip = false
								console.log($scope.cards[r][c].card.flip)
							}
						}
					}
					console.log("woot woot")
				},1000);
			}
			$scope.click = function(face){
				pair.push(face);
				$scope.numClicks++;
				if ($scope.numClicks == 2){
					//checking to see if cards matched
					if(pair[0] == pair[1]){
						$scope.wins++;
						wins = $scope.wins;
						console.log("match");
					} else{
						$scope.misses++;
					}
					$scope.numClicks = 0;
					pair.pop();
					pair.pop();
					if ($scope.wins == 6){
						var end = Math.floor(Date.now()/1000);
						$scope.playTime = end-start;
					}
				}
			}
			$scope.total = function(face){
				//keep track of total ties flipped
				$scope.totClicks++;
			}
		});

	</script>
	
</head>
<body>
	<div class= "container">
		<div class = "row">
			<div class = "col-sm-3" id="gray">
			</div>
			<div class = "col-sm-3" id="lightBlue">
			</div>
			<div class = "col-sm-3" id="peach">
			</div>
			<div class = "col-sm-3" id="darkBlue">
			</div>
		</div>
		<div class = "row" ng-view=""></div>
		<br>
		<div class = "row">
			<div class = "col-sm-3" id="gray">
			</div>
			<div class = "col-sm-3" id="lightBlue">
			</div>
			<div class = "col-sm-3" id="peach">
			</div>
			<div class = "col-sm-3" id="darkBlue">
			</div>
		</div>
	</div>


</body>
</html>
